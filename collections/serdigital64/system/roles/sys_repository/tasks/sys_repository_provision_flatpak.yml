---
- name: "System / Repository / Provision / FlatPak / Check required parameters"
  ansible.builtin.assert:
    quiet: true
    that:
      - sys_repository___provision_repo['name'] is defined
      - sys_repository___provision_repo['name'] | length > 0
      - sys_repository___provision_repo['url'] is defined
      - sys_repository___provision_repo['url'] | length > 0

- name: "System / Repository / Provision / FlatPak / Detect installed repositories"
  ansible.builtin.command:
    argv:
      - "{{ sys_repository_base['run']['flatpak'] }}"
      - "remotes"
  register: "sys_repository___provision_test"
  changed_when: false

- name: "System / Repository / Provision / FlatPak / Register repository definition (repo: {{ sys_repository___provision_repo['name'] }})"
  become: true
  ansible.builtin.command:
    argv:
      - "{{ sys_repository_base['run']['flatpak'] }}"
      - "--system"
      - "remote-add"
      - "{{ sys_repository___provision_repo['name'] }}"
      - "{{ sys_repository___provision_repo['url'] }}"
  register: "sys_repository___provision_result"
  changed_when:
    - sys_repository___provision_result['rc'] == 0
  when:
    - not sys_repository___provision_test['stdout_lines'] is search( sys_repository___provision_repo['name'] )
...
